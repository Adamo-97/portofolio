# Dev image with hot-reload and sane permissions on Linux/WSL/Windows
FROM node:20-alpine

# Create app dir and use a non-root user for better file perms on Linux
WORKDIR /app

# Install OS deps (optional but often useful)
RUN apk add --no-cache libc6-compat

# Copy only package files first to leverage Docker layer caching
COPY package.json package-lock.json* ./

# Install deps (full dev deps)
RUN npm ci

# Copy the rest of the source
COPY . .

# Expose Next.js dev server
EXPOSE 3000

# Use the node user to avoid root-owned files on host bind mounts
USER node

# Default dev command (hot reload)
CMD ["npm", "run", "dev"]
